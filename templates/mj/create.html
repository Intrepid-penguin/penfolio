{% extends 'meta.html' %}
{% load static %}
{% load widget_tweaks %}

{% block css %}
<link rel="stylesheet" href="{% static 'markdownx/admin/css/markdownx.css' %}">
<script src="{% static 'markdownx/js/markdownx.js' %}"></script>
<link rel="stylesheet" href="{% static 'mj/create.css' %}">
{% endblock css %}

{% block body %}
<section>
        <div class="head">
            <h3 class="day"></h3>
            <div class="time">
                <span class="hr"></span>
                <span class="dot">:</span>
                <span class="min"></span>
            </div>  
        </div>
        <a href="{% url 'home' %}" style="color: whitesmoke;"><i class="fa-solid fa-flask"></i></a>
    </section>
    <main>
      <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        
        <div class="input bg-white dark:bg-slate-800 dark:border dark:border-slate-700 dark:shadow-none p-6 rounded-lg shadow-xl space-y-6" 
             x-data="{ activeTab: 'edit' }">
            
            <div class="flex space-x-0 border-b border-gray-300 dark:border-slate-700 mb-4">
                <button type="button" 
                        @click="activeTab = 'edit'" 
                        :class="{
                            'bg-indigo-500 text-white font-semibold py-2 px-4 rounded-t -mb-px border-x border-t border-indigo-500 dark:border-indigo-500': activeTab === 'edit', 
                            'text-gray-600 dark:text-slate-300 font-medium py-2 px-4 rounded-t hover:bg-gray-100 dark:hover:bg-slate-700 hover:text-indigo-500 dark:hover:text-indigo-400 border-b-2 border-transparent hover:border-gray-300 dark:hover:border-slate-600': activeTab !== 'edit'
                        }"
                        class="transition-all duration-150 ease-in-out">Edit</button>
                <button type="button" 
                        @click="activeTab = 'preview'"
                        :class="{
                            'bg-indigo-500 text-white font-semibold py-2 px-4 rounded-t -mb-px border-x border-t border-indigo-500 dark:border-indigo-500': activeTab === 'preview', 
                            'text-gray-600 dark:text-slate-300 font-medium py-2 px-4 rounded-t hover:bg-gray-100 dark:hover:bg-slate-700 hover:text-indigo-500 dark:hover:text-indigo-400 border-b-2 border-transparent hover:border-gray-300 dark:hover:border-slate-600': activeTab !== 'preview'
                        }"
                        class="transition-all duration-150 ease-in-out">Preview</button>
            </div>
            
            <div x-show="activeTab === 'edit'" x-transition:enter="transition ease-out duration-100" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" x-transition:leave="transition ease-in duration-100" x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0">
                <label for="{{ form.content.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-1">Content <span class="text-red-500">*</span>:</label>
                {% render_field form.content class="w-full border-gray-300 dark:border-slate-600 rounded-md shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50" rows="10" %} 
            </div>

            <div x-show="activeTab === 'preview'" x-transition:enter="transition ease-out duration-100" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" x-transition:leave="transition ease-in duration-100" x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0"
                 class="prose dark:prose-invert lg:prose-xl max-w-none p-4 border dark:border-slate-600 rounded min-h-[200px] bg-gray-50 dark:bg-slate-700/30">
                 {% if form.instance and form.instance.pk %}
                   {{ form.instance.content|safe }}
                 {% else %}
                   <p class="text-gray-500 dark:text-slate-400 italic">Save the entry to see a preview of the rendered content here.</p>
                 {% endif %}
            </div>
            
           <div class="oth mt-4 space-y-4">
            <div>
                <label for="{{ form.title.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-1">Title <span class="text-red-500">*</span>:</label>
                {% render_field form.title class="appearance-none border dark:border-slate-600 rounded w-full py-2 px-3 text-gray-700 dark:text-slate-200 dark:bg-slate-700 dark:placeholder-slate-400 leading-tight focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Enter Title" %}
            </div>
           </div>
          
            <div class="top mt-6 flex flex-col sm:flex-row justify-between items-center space-y-4 sm:space-y-0">
                <div class="sel-c flex flex-wrap gap-x-4 gap-y-2"> {# Mood tags - using flex wrap for responsiveness #}
                    <span class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-1 sm:mb-0">Mood <span class="text-red-500">*</span>:</span>
                    {% for mood in form.mood_tag %}
                        <div class="flex items-center">
                            {{ mood.tag }} {# This renders the <input type="radio"> #}
                            <label for="{{ mood.id_for_label }}" class="ml-2 text-sm text-gray-700 dark:text-slate-300">{{ mood.choice_label }}</label>
                        </div>
                    {% endfor %}
                </div>

                <div class="submit">
                    <button type="submit" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-5 rounded-full shadow-lg flex items-center transition-all duration-200 ease-in-out hover:scale-110 hover:shadow-lg active:scale-100">
                        <i class="fa-solid fa-check-to-slot mr-2"></i> Create
                    </button>
                </div>
            </div>
        </div>
     </form>
     {{form.error}} {# This was outside the div.input, keeping original placement relative to form. #}
    </main>
{% endblock body %}

{% block script %}
<script src="{% static 'mj/create.js' %}"></script>
{% endblock script %}